# Миграция БД для функционала чатов

## Шаг 1: Запустите SQL-функцию для оптимизации

Откройте Supabase SQL Editor и выполните скрипт из файла:
```
desktop/app/db/migrations/002_qa_list_conversations_rpc.sql
```

Эта функция оптимизирует загрузку списка чатов, используя один агрегированный запрос вместо N+1 запросов.

## Что делает функция:

- Загружает все чаты за один запрос
- Использует LEFT JOIN для агрегации статистики
- Подсчитывает сообщения и файлы для каждого чата
- Находит время последнего сообщения

## Результат:

**До оптимизации:**
- 1 запрос на список чатов
- 2 запроса на каждый чат (сообщения + файлы)
- Для 50 чатов = 101 запрос

**После оптимизации:**
- 1 запрос через RPC функцию
- Для 50 чатов = 1 запрос

**Ускорение в ~100 раз!**
