2026-01-07 11:06:15,780 - __main__ - INFO - === ЗАПУСК ПРИЛОЖЕНИЯ pdfQaGemini ===
2026-01-07 11:06:15,780 - __main__ - INFO - Логи сохраняются в: C:\Users\svarovsky\PycharmProjects\pdfQaGemini\logs\desktop.log
2026-01-07 11:06:17,313 - app.ui.main_window - INFO - === НАЧАЛО ПОДКЛЮЧЕНИЯ ===
2026-01-07 11:06:17,321 - app.ui.main_window - INFO - Конфигурация загружена
2026-01-07 11:06:17,321 - app.ui.main_window - INFO - Используется client_id: 3cbb1afb-b877-4eb5-b2a7-16c358033733
2026-01-07 11:06:17,520 - app.services.supabase_repo - INFO - Инициализация SupabaseRepo: url=https://zivbesacbxfmwzervmcy.s...
2026-01-07 11:06:17,520 - app.ui.main_window - INFO - Локальный режим (без сервера)
2026-01-07 11:06:17,521 - app.ui.left_projects_panel - INFO - LeftProjectsPanel.set_services вызван: supabase_repo=True
2026-01-07 11:06:17,523 - app.services.supabase_repo - INFO - Создание Supabase клиента...
2026-01-07 11:06:17,833 - app.services.supabase_repo - INFO - Supabase клиент создан успешно
2026-01-07 11:06:18,399 - httpx - INFO - HTTP Request: POST https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/rpc/qa_list_conversations_with_stats "HTTP/2 200 OK"
2026-01-07 11:06:18,448 - app.ui.left_projects_panel - INFO - === ЗАГРУЗКА КОРНЕВЫХ УЗЛОВ для client_id=3cbb1afb-b877-4eb5-b2a7-16c358033733 ===
2026-01-07 11:06:18,454 - app.services.supabase_repo - INFO - fetch_roots вызван
2026-01-07 11:06:18,454 - app.services.supabase_repo - INFO - _sync_fetch: получение клиента...
2026-01-07 11:06:18,454 - app.services.supabase_repo - INFO - _sync_fetch: выполнение запроса к tree_nodes...
2026-01-07 11:06:18,566 - httpx - INFO - HTTP Request: GET https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/tree_nodes?select=%2A&parent_id=is.null&order=sort_order.asc%2Cname.asc "HTTP/2 200 OK"
2026-01-07 11:06:18,568 - app.services.supabase_repo - INFO - _sync_fetch: получено 4 записей
2026-01-07 11:06:18,570 - app.ui.left_projects_panel - ERROR - ОШИБКА ЗАГРУЗКИ: 1 validation error for TreeNode
client_id
  Field required [type=missing, input_value={'id': '0e8b64be-823a-458...': 33, 'files_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
Traceback (most recent call last):
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\ui\left_projects_panel.py", line 319, in load_roots
    roots = await self.supabase_repo.fetch_roots(client_id=client_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\services\supabase_repo.py", line 52, in fetch_roots
    result = await asyncio.to_thread(_sync_fetch)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\AppData\Local\Programs\Python\Python312\Lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\qasync\__init__.py", line 142, in run
    r = callback(*args, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\services\supabase_repo.py", line 50, in _sync_fetch
    return [TreeNode(**row) for row in response.data]
            ^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\pydantic\main.py", line 250, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TreeNode
client_id
  Field required [type=missing, input_value={'id': '0e8b64be-823a-458...': 33, 'files_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
2026-01-07 11:06:18,581 - app.services.gemini_client - INFO - Возвращаем фиксированный список моделей Gemini 3
2026-01-07 11:06:18,582 - app.ui.chat_panel - INFO - set_models вызван с 2 моделями
2026-01-07 11:06:18,582 - app.ui.chat_panel - INFO - Добавлено 2 моделей в комбобокс
2026-01-07 11:06:18,713 - httpx - INFO - HTTP Request: GET https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/user_prompts?select=%2A&client_id=eq.3cbb1afb-b877-4eb5-b2a7-16c358033733&order=created_at.desc "HTTP/2 200 OK"
2026-01-07 11:06:18,714 - app.ui.main_window - INFO - Загружено 0 промтов
2026-01-07 11:06:18,715 - app.ui.main_window - INFO - === ПОДКЛЮЧЕНИЕ УСПЕШНО (локальный режим) ===
2026-01-07 11:14:40,126 - __main__ - INFO - === ЗАПУСК ПРИЛОЖЕНИЯ pdfQaGemini ===
2026-01-07 11:14:40,126 - __main__ - INFO - Логи сохраняются в: C:\Users\svarovsky\PycharmProjects\pdfQaGemini\logs\desktop.log
2026-01-07 11:14:41,347 - app.ui.main_window - INFO - === НАЧАЛО ПОДКЛЮЧЕНИЯ ===
2026-01-07 11:14:41,354 - app.ui.main_window - INFO - Конфигурация загружена
2026-01-07 11:14:41,354 - app.ui.main_window - INFO - Используется client_id: 3cbb1afb-b877-4eb5-b2a7-16c358033733
2026-01-07 11:14:41,457 - app.services.supabase_repo - INFO - Инициализация SupabaseRepo: url=https://zivbesacbxfmwzervmcy.s...
2026-01-07 11:14:41,457 - app.ui.main_window - INFO - Локальный режим (без сервера)
2026-01-07 11:14:41,458 - app.ui.left_projects_panel - INFO - LeftProjectsPanel.set_services вызван: supabase_repo=True
2026-01-07 11:14:41,460 - app.services.supabase_repo - INFO - Создание Supabase клиента...
2026-01-07 11:14:41,617 - app.services.supabase_repo - INFO - Supabase клиент создан успешно
2026-01-07 11:14:42,128 - httpx - INFO - HTTP Request: POST https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/rpc/qa_list_conversations_with_stats "HTTP/2 200 OK"
2026-01-07 11:14:42,130 - app.ui.left_projects_panel - INFO - === ЗАГРУЗКА КОРНЕВЫХ УЗЛОВ для client_id=3cbb1afb-b877-4eb5-b2a7-16c358033733 ===
2026-01-07 11:14:42,135 - app.services.supabase_repo - INFO - fetch_roots вызван
2026-01-07 11:14:42,136 - app.services.supabase_repo - INFO - _sync_fetch: получение клиента...
2026-01-07 11:14:42,136 - app.services.supabase_repo - INFO - _sync_fetch: выполнение запроса к tree_nodes...
2026-01-07 11:14:42,253 - httpx - INFO - HTTP Request: GET https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/tree_nodes?select=%2A&parent_id=is.null&order=sort_order.asc%2Cname.asc "HTTP/2 200 OK"
2026-01-07 11:14:42,253 - app.services.supabase_repo - INFO - _sync_fetch: получено 4 записей
2026-01-07 11:14:42,254 - app.ui.left_projects_panel - ERROR - ОШИБКА ЗАГРУЗКИ: 1 validation error for TreeNode
client_id
  Field required [type=missing, input_value={'id': '0e8b64be-823a-458...': 33, 'files_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
Traceback (most recent call last):
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\ui\left_projects_panel.py", line 319, in load_roots
    roots = await self.supabase_repo.fetch_roots(client_id=client_id)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\services\supabase_repo.py", line 52, in fetch_roots
    result = await asyncio.to_thread(_sync_fetch)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\AppData\Local\Programs\Python\Python312\Lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\qasync\__init__.py", line 142, in run
    r = callback(*args, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\services\supabase_repo.py", line 50, in _sync_fetch
    return [TreeNode(**row) for row in response.data]
            ^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\pydantic\main.py", line 250, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TreeNode
client_id
  Field required [type=missing, input_value={'id': '0e8b64be-823a-458...': 33, 'files_count': 0}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.12/v/missing
2026-01-07 11:14:42,263 - app.services.gemini_client - INFO - Возвращаем фиксированный список моделей Gemini 3
2026-01-07 11:14:42,263 - app.ui.chat_panel - INFO - set_models вызван с 2 моделями
2026-01-07 11:14:42,263 - app.ui.chat_panel - INFO - Добавлено 2 моделей в комбобокс
2026-01-07 11:14:42,387 - httpx - INFO - HTTP Request: GET https://zivbesacbxfmwzervmcy.supabase.co/rest/v1/user_prompts?select=%2A&client_id=eq.3cbb1afb-b877-4eb5-b2a7-16c358033733&order=created_at.desc "HTTP/2 200 OK"
2026-01-07 11:14:42,387 - app.ui.main_window - INFO - Загружено 0 промтов
2026-01-07 11:14:42,387 - app.ui.main_window - INFO - === ПОДКЛЮЧЕНИЕ УСПЕШНО (локальный режим) ===
2026-01-07 13:14:37,004 - __main__ - INFO - === ЗАПУСК ПРИЛОЖЕНИЯ pdfQaGemini ===
2026-01-07 13:14:37,004 - __main__ - INFO - Логи сохраняются в: C:\Users\svarovsky\PycharmProjects\pdfQaGemini\logs\desktop.log
2026-01-07 13:15:27,448 - app.ui.main_window - INFO - === НАЧАЛО ПОДКЛЮЧЕНИЯ ===
2026-01-07 13:15:27,448 - app.ui.main_window - WARNING - Настройки не сконфигурированы
2026-01-07 13:16:01,644 - app.ui.main_window - INFO - === НАЧАЛО ПОДКЛЮЧЕНИЯ ===
2026-01-07 13:16:01,649 - app.ui.main_window - INFO - Подключение к серверу: http://localhost:8000
2026-01-07 13:16:32,104 - app.ui.main_window - ERROR - ОШИБКА ПОДКЛЮЧЕНИЯ: 
Traceback (most recent call last):
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_transports\default.py", line 101, in map_httpcore_exceptions
    yield
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_transports\default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\http11.py", line 136, in handle_async_request
    raise exc
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_async\http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpcore\_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadTimeout

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\ui\main_window.py", line 335, in _on_connect
    server_config = await APIClient.fetch_config(server_url, api_token)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\desktop\app\services\api_client.py", line 45, in fetch_config
    response = await client.get(
               ^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1768, in get
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_transports\default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\svarovsky\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "C:\Users\svarovsky\PycharmProjects\pdfQaGemini\.venv\Lib\site-packages\httpx\_transports\default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadTimeout
